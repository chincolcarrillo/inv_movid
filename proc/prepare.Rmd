---
title: "Codigo de preparacion movid_legitimidad"
---

# Descripción general

Se realiza un codigo de preparacion de datos para posterior analisis en el informe final movid_legitimidad.

# Librerías

```{r}
# install.packages("pacman")
# library(pacman)
pacman::p_load(dplyr, summarytools, sjmisc, car, sjlabelled, stargazer, scales)
```

# Data

Se realizan ajustes generales para trabajar desde RStudio y se carga la base de datos original en formato CSV.

```{r}
rm(list=ls())       
options(scipen=999)   

movid_original <- read.csv("datos/MOVID-IMPACT.csv")
```

Se filtra la base, dejando sólo aquellos casos que respondieron la encuesta. Esto, ya que MOVID-impact es una encuesta transversal a hogares, se registran los datos de todos los miembros del hogar pero sólo uno responde la encuesta completa. 
Se seleccionan las variables de interés.

```{r}
proc_movid <- movid_original %>%
  filter(entrevistado == 1) %>% 
  select(sexo, edad, desigualdad_p = f3_1, informacion = f5_2, legitimidad = f3_3, peligro_p = f6)

View(proc_movid)
```

Se recodifican los valores y casos perdidos de las variables de interés.

```{r}
proc_movid$sexo <- recode(proc_movid$sexo, "'Hombre' = 0; 'Mujer' = 1")
proc_movid$sexo <- as_numeric(proc_movid$sexo)

proc_movid$neduc <- recode(proc_movid$neduc, "'Nunca asistió' = 1; 
                         'Especial (Diferencial)' = 2;
                         'Básica' = 2;
                         'Media Científico-Humanista' = 3;
                         'Media Técnica-Profesional' = 3;
                         'Superior Técnica (CFT o I. Profesional)' = 4;
                         'Superior Universitaria (Pregrado)' = 5;
                         'Postgrado' = 6;
                         'No sabe/no responde' = NA")

proc_movid$peligro_p <- recode(proc_movid$peligro_p, "'No sabe' = NA; 'Nada peligroso' = 1;
                        'Algo peligroso' = 2; 'Bastante peligroso' = 3; 'Muy peligroso' = 4;
                        'Extremadamente peligroso' = 5; 'No responde' = NA")

proc_movid$legitimidad <- recode(proc_movid$legitimidad, "'No sabe' = NA; 'No responde' = NA; 
                          'Muy en desacuerdo' = 1; 'En desacuerdo' = 2;
                          'Indiferente' = 3; 'De acuerdo' = 4; 'Muy de acuerdo' = 5")

proc_movid$legitimidad_dico <- recode(proc_movid$legitimidad, "'No sabe' = NA; 'No responde' = NA; 
                          '1' = 0; '2' = 0;
                          '3' = 0; '4' = 1; '5' = 1")

```

Para poder utilizar como variable contínua el ingreso_pp incluso en los casos en que no se respondió el monto exacto de ingreso del hogar, se realiza una aproximación a la marca de clase de cada tramo de ingreso entregado en la variable "tingreso"
A continuación, se 

```{r}
proc_movid <- proc_movid %>%
  mutate(tingreso = case_when(tingreso == "Menos de $200 mil pesos" ~ 200000,
                              tingreso == "Entre $200 y 350 mil pesos" ~ 275000,
                              tingreso == "Entre $351 y 500 mil pesos" ~ 425500,
                              tingreso == "Entre 501 y 800 mil pesos" ~ 650500,
                              tingreso == "Entre 801 mil y 1 millón 200 mil pesos" ~ 1000500,
                              tingreso == "Entre 1 millón 201 mil y 2 millones de pesos" ~ 1600500,
                              tingreso == "Entre 2 millones y 5 millones de pesos" ~ 3500000,
                              tingreso == "Más de 5 millones de pesos" ~ 5000000))


proc_movid$ingreso_i <- ifelse(test = (is.na(proc_movid$ingreso)), 
                               yes = proc_movid$tingreso,         
                               no = proc_movid$ingreso)     
```

Finalmente se crea la variable ingreso_pp dividiendo el ingreso_i del hogar por las personas que componen el hogar

```{r}
proc_movid$ingreso_pp <- proc_movid$ingreso_i/proc_movid$familia
```

# Información de la sesión

```{r}
print(paste("R", getRversion()))
print("*** Versiones de librerías")
for (package_name in sort(loadedNamespaces())) {
    print(paste(package_name, packageVersion(package_name)))
}

```
